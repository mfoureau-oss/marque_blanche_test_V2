<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimation BMW</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: white;
            min-height: 100vh;
        }

        /* Hero Section */
        .hero {
            background: white;
            padding: 100px 20px 60px 20px;
            border-bottom: 1px solid #E9EDF5;
            position: relative;
        }

        .burger {
            position: absolute;
            top: 24px;
            left: 24px;
            width: 24px;
            height: 20px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .burger span {
            width: 24px;
            height: 2px;
            background: #0E0E11;
            display: block;
        }

        .hero-content {
            max-width: 1140px;
            margin: 0 auto;
            text-align: center;
        }

        .logo {
            width: 88px;
            height: 88px;
            margin: 0 auto 28px auto;
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 8px;
            background: white;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        h1 {
            font-size: clamp(32px, 4vw, 48px);
            font-weight: 800;
            color: #0E0E11;
            margin-bottom: 14px;
        }

        .subtitle {
            font-size: 19px;
            color: #3A3F4B;
            line-height: 1.5;
        }

        /* Options Section */
        .options {
            background: linear-gradient(135deg, #E8E6F7 0%, #F3F2FA 100%);
            padding: 80px 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }

        .options-container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .options h2 {
            font-size: 48px;
            font-weight: 600;
            color: #1a1a1a;
            text-align: center;
            margin-bottom: 70px;
        }

        .cards-wrapper {
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
        }

        .card {
            background: #FFFEF5;
            border: 2px solid #E5E5E5;
            border-radius: 24px;
            padding: 50px 40px;
            width: 100%;
            max-width: 580px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .card:hover {
            background: #F8F6ED;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .card.selected {
            border-color: #4A3AFF;
        }

        .badge {
            background: #4A3AFF;
            color: white;
            padding: 10px 24px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 40px;
            text-transform: uppercase;
            display: inline-block;
        }

        .card h3 {
            font-size: 32px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 30px;
        }

        .card p {
            font-size: 18px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 50px;
            max-width: 380px;
            margin-left: auto;
            margin-right: auto;
        }

        .features {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 500;
            color: #4A3AFF;
        }

        .feature::before {
            content: '✓';
            font-weight: bold;
        }

        .divider {
            font-size: 36px;
            font-weight: 600;
            color: #1a1a1a;
            padding: 0 20px;
        }

        /* Section cachée par défaut */
        .progressive-section {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }

        .progressive-section.revealed {
            display: block;
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Styles pour la section immatriculation mise à jour */
        .main-section {
            background: #FAFBFD;
            border-radius: 24px;
            padding: 80px 20px;
            margin: 0 20px;
        }

        .container {
            max-width: 1140px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
        }

        .page-title {
            font-size: 42px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 16px;
        }

        .page-subtitle {
            font-size: 18px;
            color: #666;
            font-weight: 400;
            margin-bottom: 32px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: start;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .immatriculation-input {
            width: 100%;
            height: 56px;
            padding: 0 24px;
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            background: white;
            color: #333;
            outline: none;
            transition: all 0.3s ease;
        }

        .immatriculation-input:focus {
            border-color: #4A40FF;
            box-shadow: 0 0 0 3px rgba(74, 64, 255, 0.1);
        }

        .immatriculation-input::placeholder {
            color: #999;
            font-weight: 400;
            letter-spacing: normal;
        }

        .search-button {
            width: 100%;
            height: 56px;
            background: #9ca3af;
            color: #6b7280;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: not-allowed;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .search-button.active {
            background: #4A40FF;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(74, 64, 255, 0.3);
        }

        .search-button:hover.active {
            background: #3730a3;
            transform: translateY(-1px);
        }

        .format-info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }

        .format-title {
            font-size: 14px;
            font-weight: 600;
            color: #475569;
            margin-bottom: 4px;
        }

        .format-text {
            font-size: 13px;
            color: #64748b;
            line-height: 1.4;
        }

        .result-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-height: 400px;
            height: fit-content;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 28px;
        }

        .result-icon {
            width: 36px;
            height: 36px;
            background: #4F46E5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .result-title {
            font-size: 22px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px 40px;
            margin-bottom: 24px;
        }

        .result-item {
            font-size: 14px;
            color: #475569;
        }

        .result-label {
            font-weight: 600;
            color: #1e293b;
        }

        .version-selection-section {
            margin: 24px 0;
            padding: 20px;
            background: #F8FAFC;
            border-radius: 12px;
            border: 1px solid #E2E8F0;
        }

        .field-card {
            position: relative;
            background: #F0F2F5;
            border: 1.5px solid #D5D8E0;
            border-radius: 16px;
            padding: 14px 24px;
            height: 70px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .field-card.selected {
            background: #EBF4FF;
            border-color: #4F46E5;
        }

        .field-label {
            font-size: 10px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            line-height: 1;
        }

        .field-value {
            font-size: 16px;
            color: #333;
            font-weight: 500;
            line-height: 1.2;
        }

        .field-value.placeholder {
            color: #999;
        }

        .native-select {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 1;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: none;
            background: none;
        }

        .validate-btn-inline {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: #CBD5E1;
            color: #9CA3AF;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: not-allowed;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .validate-btn-inline:not(.disabled) {
            background: #4A40FF;
            color: white;
            cursor: pointer;
        }

        .validate-btn-inline:not(.disabled):hover {
            background: #3730A3;
        }

        .version-help-text {
            font-size: 13px;
            color: #64748B;
            margin-top: 8px;
            line-height: 1.4;
        }

        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 5px;
            font-weight: 500;
        }

        .immatriculation-input.error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .immatriculation-input.valid {
            border-color: #4F46E5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal styles - Hidden by default */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 24px 0 24px;
        }

        .modal-close {
            background: #f1f5f9;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #64748b;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #e2e8f0;
            color: #475569;
        }

        .modal-body {
            padding: 24px;
        }

        /* Desktop specific styles to ensure desktop layout is preserved */
        @media (min-width: 769px) {
            .modal-overlay {
                display: none !important;
            }
        }

        /* Caractéristiques Section */
        .caracteristiques-section {
            background: #F8F9FC;
            border-radius: 32px;
            padding: 80px 20px;
            margin: 0 20px;
        }

        .section-title {
            font-size: 42px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .section-subtitle {
            font-size: 18px;
            color: #666;
            font-weight: 400;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Changed from 3 columns to 2 columns for better balance in desktop */
            gap: 20px;
            margin-bottom: 40px;
        }

        .chevron {
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .chevron::after {
            content: '›';
            color: #666;
            font-size: 18px;
            font-weight: 600;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .field-card.selected .chevron {
            background: #4F46E5;
        }

        .field-card.selected .chevron::after {
            content: '✓';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .separator {
            height: 1px;
            background: #E0E0E0;
            margin: 0 0 20px 0;
        }

        .footer-info {
            font-size: 14px;
            color: #666;
        }

        /* État général Section */
        .cards-row {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 60px;
            flex-wrap: nowrap;
        }

        .state-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 35px 20px;
            width: 200px;
            height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
            flex-shrink: 0;
        }

        .state-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .state-card.selected {
            border-color: #2D2DFF;
        }

        .star-icon {
            width: 44px;
            height: 44px;
            margin-bottom: 16px;
            stroke: #1a1a1a;
            stroke-width: 2;
            fill: none;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .card-subtitle {
            font-size: 14px;
            color: #999;
            line-height: 1.3;
        }

        .explanation-zone {
            text-align: center;
        }

        .selected-state-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .selected-state-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 24px;
        }

        .impact-chip {
            display: inline-block;
            background: #D6DCFF;
            color: #2D2DFF;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 600;
        }

        /* Options Section */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .options-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .option-card {
            position: relative;
            background: white;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-color: #d1d5db;
        }

        .option-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .category-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .checkbox {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .checkbox.checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        .option-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
        }

        .info-section {
            background-color: #eff6ff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #bfdbfe;
        }

        /* Contact Section */
        .summary-block {
            background: #F0F2F5;
            border: 1.5px solid #D5D8E0;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 24px;
            transition: all 0.3s ease;
        }

        .summary-block:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: #B8BCC8;
        }

        .summary-icon {
            width: 48px;
            height: 48px;
            background: #E8F4FD;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .summary-icon svg {
            width: 24px;
            height: 24px;
            color: #2563EB;
        }

        .summary-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .summary-main {
            flex: 1;
        }

        .summary-label {
            font-size: 10px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .summary-price {
            font-size: 32px;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1;
        }

        .summary-divider {
            width: 1px;
            height: 40px;
            background: #D5D8E0;
            flex-shrink: 0;
        }

        /* Hide summary-divider on desktop only */
        @media (min-width: 769px) {
            .summary-divider {
                display: none;
            }
        }

        .summary-secondary {
            text-align: right;
            position: relative;
        }

        .summary-secondary-label {
            font-size: 10px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .summary-secondary-text {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .steps-accent {
            position: absolute;
            left: -12px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #F59E0B;
            border-radius: 2px;
        }

        .field-input {
            background: transparent;
            border: none;
            font-size: 16px;
            color: #333;
            font-weight: 500;
            outline: none;
            width: 100%;
            position: relative;
            z-index: 2;
        }

        .field-input::placeholder {
            color: #999;
        }

        .field-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: #B8BCC8;
        }

        .field-card:focus-within {
            outline: 2px solid #4A40FF;
            outline-offset: 2px;
        }

        .contact-preferences {
            margin-bottom: 30px;
        }

        .contact-preferences-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .contact-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .contact-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .contact-card.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .contact-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
        }

        .contact-card.selected .contact-checkbox {
            border-color: #3b82f6;
            background: #3b82f6;
        }

        .contact-card.selected .contact-checkbox::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
        }

        .contact-icon {
            width: 40px;
            height: 40px;
            background: #f3f4f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            flex-shrink: 0;
        }

        .contact-card.selected .contact-icon {
            background: #dbeafe;
            color: #3b82f6;
        }

        .contact-icon svg {
            width: 20px;
            height: 20px;
        }

        .contact-info {
            flex: 1;
        }

        .contact-title {
            font-weight: 600;
            color: #111827;
            margin-bottom: 2px;
        }

        .contact-subtitle {
            font-size: 14px;
            color: #6b7280;
        }

        /* Adding styles for bonus block */
        .bonus-block {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .bonus-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bonus-icon {
            width: 50px;
            height: 50px;
            background: #10b981;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .bonus-icon svg {
            width: 24px;
            height: 24px;
        }

        .bonus-text {
            flex: 1;
        }

        .bonus-title {
            font-size: 18px;
            font-weight: 600;
            color: #10b981;
            margin-bottom: 4px;
        }

        .bonus-subtitle {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.4;
        }

        /* Adding CTA button section */
        .cta-section {
            margin-top: 50px;
            text-align: center;
            padding: 30px 0;
        }

        .cta-button {
            background: linear-gradient(135deg, #10C876 0%, #0EA968 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 48px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(16, 200, 118, 0.2);
            display: inline-block;
            text-decoration: none;
        }

        .cta-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(16, 200, 118, 0.3);
            background: linear-gradient(135deg, #0EA968 0%, #0D9B5F 100%);
        }

        .cta-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(16, 200, 118, 0.2);
        }

        .footer-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #E0E0E0;
            text-align: center;
        }

        /* Mobile specific styles */
        @media (max-width: 768px) {
            .main-section {
                padding: 50px 20px;
            }

            .page-title {
                font-size: 32px;
            }

            .page-subtitle {
                font-size: 16px;
            }

            .grid-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            /* Hide desktop result card on mobile */
            .result-card {
                display: none !important;
            }

            /* Modal specific mobile styles */
            .modal-content {
                width: 95%;
                margin: 20px;
                max-height: 85vh;
            }

            .modal-result-grid {
                display: grid;
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                margin-bottom: 24px;
            }

            .modal-result-item {
                padding: 8px 0;
                border-bottom: 1px solid #F1F5F9;
                font-size: 14px;
                color: #475569;
            }

            .modal-result-item:last-child {
                border-bottom: none;
            }

            .modal-result-label {
                font-weight: 600;
                min-width: 80px;
                display: inline-block;
                color: #1e293b;
            }

            .modal-version-selection {
                margin: 16px 0 !important;
                padding: 16px !important;
                background: #F8FAFC;
                border-radius: 8px;
                position: relative;
            }

            /* NOUVEAU STYLE COMPACT POUR LE DROPDOWN MOBILE */
            .modal-field-card {
                position: relative;
                padding: 6px 12px 44px 12px;
                background: #F0F2F5;
                border: 1.5px solid #D5D8E0;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.3s ease;
                height: 100px;
            }

            .modal-field-card.selected {
                background: #EBF4FF;
                border-color: #4F46E5;
            }

            .modal-field-card .field-label {
                font-size: 9px;
                position: absolute;
                top: 5px;
                left: 12px;
                font-weight: 600;
                color: #666;
                text-transform: uppercase;
                letter-spacing: 0.4px;
            }

            .modal-field-card .field-value {
                font-size: 13px;
                padding: 18px 12px 12px 12px;
                line-height: 1.3;
                color: #333;
                font-weight: 500;
                min-height: 34px;
            }

            .modal-field-card .field-value.placeholder {
                color: #999;
            }

            .modal-validate-btn {
                position: absolute;
                bottom: 8px;
                left: 12px;
                right: 12px;
                padding: 9px 12px;
                font-size: 12px;
                border-radius: 6px;
                background: #CBD5E1;
                color: #9CA3AF;
                border: none;
                font-weight: 500;
                cursor: not-allowed;
                transition: all 0.2s ease;
                height: 35px;
                z-index: 10;
            }

            .modal-validate-btn:not(.disabled) {
                background: #4A40FF;
                color: white;
                cursor: pointer;
            }

            .modal-validate-btn:not(.disabled):hover {
                background: #3730A3;
            }

            .modal-field-card .native-select {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 36px;
                opacity: 0;
                z-index: 5;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                border: none;
                background: none;
                cursor: pointer;
            }

            .modal-version-help-text {
                font-size: 10px;
                margin-top: 8px;
                text-align: center;
                color: #64748B;
                line-height: 1.4;
            }

            .options {
                padding: 40px 15px;
                min-height: auto;
            }
            
            .options h2 {
                font-size: 28px;
                margin-bottom: 40px;
                line-height: 1.2;
            }
            
            .options .cards-wrapper {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .options .card {
                max-width: none;
                padding: 30px 20px;
                margin: 0;
            }
            
            .options .card h3 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .options .card p {
                font-size: 16px;
                margin-bottom: 30px;
                max-width: none;
            }
            
            .options .features {
                gap: 20px;
                flex-direction: column;
                align-items: center;
            }
            
            .options .feature {
                font-size: 14px;
            }
            
            .divider {
                font-size: 24px;
                font-weight: 600;
                color: #1a1a1a;
                padding: 15px 0;
                background: white;
                border-radius: 20px;
                width: 80px;
                text-align: center;
                margin: 0 auto;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .summary-block {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .summary-content {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .summary-divider {
                width: 100%;
                height: 1px;
            }

            .summary-secondary {
                text-align: left;
                width: 100%;
            }

            .summary-price {
                font-size: 28px;
            }

            .contact-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .contact-preferences-title {
                font-size: 24px;
            }

            .cta-button {
                width: 100%;
                max-width: 320px;
                padding: 16px 32px;
                font-size: 16px;
            }
            
            .cta-section {
                padding: 20px 0;
            }

            .cards-row {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .state-card {
                width: calc(50% - 7.5px);
                min-width: 160px;
            }

            /* Mobile styles for bonus block */
            .bonus-block {
                padding: 15px;
                margin-bottom: 25px;
            }

            .bonus-content {
                gap: 12px;
            }

            .bonus-icon {
                width: 45px;
                height: 45px;
            }

            .bonus-title {
                font-size: 16px;
            }

            .bonus-subtitle {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .options {
                padding: 30px 10px;
            }
            
            .options h2 {
                font-size: 24px;
                margin-bottom: 30px;
            }
            
            .options .card {
                padding: 25px 15px;
            }
            
            .options .card h3 {
                font-size: 20px;
            }
            
            .badge {
                font-size: 12px;
                padding: 8px 16px;
                margin-bottom: 20px;
            }
            
            .divider {
                font-size: 20px;
                width: 60px;
            }

            .cards-row {
                flex-direction: column;
                align-items: center;
            }
            
            .state-card {
                width: 100%;
                max-width: 280px;
            }
        }

        .input-valid {
            border-color: #4F46E5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Added rule to display project fields vertically instead of horizontally */
        @media (max-width: 768px) {
            .project-section .form-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section (gardé identique) -->
    <section class="hero">
        <div class="burger">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <div class="hero-content">
            <div class="logo">
                <img src="https://cdn.pixabay.com/photo/2016/08/15/18/18/bmw-1596080_1280.png" alt="BMW Logo">
            </div>
            <h1>Estimation de votre véhicule</h1>
            <p class="subtitle">Obtenez une estimation précise en quelques minutes</p>
        </div>
    </section>

    <!-- Options Section (gardé identique) -->
    <section class="options">
        <div class="options-container">
            <h2>Comment souhaitez-vous procéder ?</h2>
            
            <div class="cards-wrapper">
                <div class="card" onclick="showImmatriculation()">
                    <span class="badge">2 MINUTES CHRONO</span>
                    <h3>Par immatriculation</h3>
                    <p>Finalisez votre vente en ligne, nous venons récupérer votre véhicule chez vous</p>
                    <div class="features">
                        <div class="feature">Zéro erreur</div>
                        <div class="feature">Plus rapide</div>
                        <div class="feature">Données officielles</div>
                    </div>
                </div>
                
                <div class="divider">OU</div>
                
                <div class="card" onclick="showCaracteristiques()">
                    <span class="badge">PLUS PRÉCIS POUR VOUS</span>
                    <h3>Recherche manuelle</h3>
                    <p>Finalisez votre vente en ligne, nous venons récupérer votre véhicule chez vous</p>
                    <div class="features">
                        <div class="feature">Zéro erreur</div>
                        <div class="feature">Plus rapide</div>
                        <div class="feature">Données officielles</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Recherche Immatriculation - REMPLACÉE -->
    <section class="progressive-section" id="immatriculation-section">
        <div class="main-section">
            <div class="container">
                <div class="header">
                    <h1 class="page-title">Recherche par immatriculation</h1>
                    <p class="page-subtitle">Saisissez votre plaque d'immatriculation pour une recherche automatique</p>
                </div>

                <div class="grid-container">
                    <div class="left-column">
                        <div class="input-group">
                            <label class="input-label" for="immat-input">Plaque d'immatriculation</label>
                            <input type="text" class="immatriculation-input" id="immat-input" placeholder="AB123CD" maxlength="7" oninput="validateImmatFormat(this)">
                            <div class="error-message" id="immat-error" style="display: none;">Format attendu : AB123CD</div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="km-input">Kilométrage actuel</label>
                            <input type="number" class="immatriculation-input" id="km-input" placeholder="50000" min="0" max="500000" oninput="validateKmFormat(this)">
                            <div class="error-message" id="km-error" style="display: none;">Veuillez saisir un kilométrage valide</div>
                        </div>
                        
                        <button type="button" id="search-btn" class="search-button" disabled onclick="searchImmatriculation()">
                            <span id="search-text">Rechercher le véhicule</span>
                        </button>
                        
                        <div class="format-info">
                            <div class="format-title">Format accepté</div>
                            <div class="format-text">Format : AB123CD (7 caractères sans tirets ni espaces)</div>
                        </div>
                    </div>

                    <!-- Desktop result card -->
                    <div class="result-card" id="result-card" style="display: none;">
                        <div class="result-header">
                            <div class="result-icon">✓</div>
                            <h2 class="result-title">Véhicule trouvé !</h2>
                        </div>
                        
                        <div class="result-grid">
                            <div class="result-item"><span class="result-label">Marque:</span> Renault</div>
                            <div class="result-item"><span class="result-label">Carburant:</span> Essence</div>
                            <div class="result-item"><span class="result-label">Modèle:</span> Clio V</div>
                            <div class="result-item"><span class="result-label">Puissance:</span> 90 ch</div>
                            <div class="result-item"><span class="result-label">Année:</span> 2021</div>
                            <div class="result-item"><span class="result-label">Couleur:</span> Blanc</div>
                        </div>

                        <div class="version-selection-section">
                            <div class="field-card" data-field="modal-version">
                                <select class="native-select" id="modal-version-select" onchange="updateFieldDisplay(this); updateValidateButton();">
                                    <option value="">Sélectionnez la version de votre véhicule</option>
                                    <option value="Active 1.2 PureTech 100">Active 1.2 PureTech 100</option>
                                    <option value="Allure 1.2 PureTech 130">Allure 1.2 PureTech 130</option>
                                    <option value="GT Line 1.2 PureTech 130">GT Line 1.2 PureTech 130</option>
                                    <option value="GT 1.6 THP 205">GT 1.6 THP 205</option>
                                    <option value="Style 1.0 VTi 68">Style 1.0 VTi 68</option>
                                    <option value="Shine 1.2 PureTech 110">Shine 1.2 PureTech 110</option>
                                    <option value="Crossway 1.2 PureTech 110">Crossway 1.2 PureTech 110</option>
                                    <option value="Roland Garros 1.2 PureTech 100">Roland Garros 1.2 PureTech 100</option>
                                    <option value="Signature 1.2 PureTech 130">Signature 1.2 PureTech 130</option>
                                    <option value="Tech Edition 1.2 PureTech 100">Tech Edition 1.2 PureTech 100</option>
                                </select>
                                <div class="field-label">VERSION *</div>
                                <div class="field-value placeholder">Sélectionnez la version de votre véhicule</div>
                                <button id="validate-button" onclick="proceedToNextStep()" disabled class="validate-btn-inline disabled">
                                    Valider
                                </button>
                            </div>
                            <div class="version-help-text">
                                Les informations ont été récupérées via notre référentiel
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Modal -->
        <div class="modal-overlay" id="mobile-modal" onclick="closeModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="result-header">
                        <div class="result-icon">✓</div>
                        <h2 class="result-title">Véhicule trouvé !</h2>
                    </div>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <div class="modal-result-grid">
                        <div class="modal-result-item"><span class="modal-result-label">Marque:</span> Renault</div>
                        <div class="modal-result-item"><span class="modal-result-label">Carburant:</span> Essence</div>
                        <div class="modal-result-item"><span class="modal-result-label">Modèle:</span> Clio V</div>
                        <div class="modal-result-item"><span class="modal-result-label">Puissance:</span> 90 ch</div>
                        <div class="modal-result-item"><span class="modal-result-label">Année:</span> 2021</div>
                        <div class="modal-result-item"><span class="modal-result-label">Couleur:</span> Blanc</div>
                    </div>

                    <div class="modal-version-selection">
                        <div class="modal-field-card" data-field="modal-version-mobile">
                            <select class="native-select" id="modal-version-select-mobile" onchange="updateModalFieldDisplay(this); updateModalValidateButton();">
                                <option value="">Sélectionnez la version de votre véhicule</option>
                                <option value="Active 1.2 PureTech 100">Active 1.2 PureTech 100</option>
                                <option value="Allure 1.2 PureTech 130">Allure 1.2 PureTech 130</option>
                                <option value="GT Line 1.2 PureTech 130">GT Line 1.2 PureTech 130</option>
                                <option value="GT 1.6 THP 205">GT 1.6 THP 205</option>
                                <option value="Style 1.0 VTi 68">Style 1.0 VTi 68</option>
                                <option value="Shine 1.2 PureTech 110">Shine 1.2 PureTech 110</option>
                                <option value="Crossway 1.2 PureTech 110">Crossway 1.2 PureTech 110</option>
                                <option value="Roland Garros 1.2 PureTech 100">Roland Garros 1.2 PureTech 100</option>
                                <option value="Signature 1.2 PureTech 130">Signature 1.2 PureTech 130</option>
                                <option value="Tech Edition 1.2 PureTech 100">Tech Edition 1.2 PureTech 100</option>
                            </select>
                            <div class="field-label">VERSION *</div>
                            <div class="field-value placeholder">Sélectionnez la version de votre véhicule</div>
                            <button id="modal-validate-button" onclick="proceedToNextStepFromModal()" disabled class="modal-validate-btn disabled">
                                Valider
                            </button>
                        </div>
                        <div class="modal-version-help-text">
                            Les informations ont été récupérées via notre référentiel
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Suppression et réécriture complète de la section caractéristiques du véhicule sans scroll automatique -->
    <section class="progressive-section" id="caracteristiques-section">
        <div class="caracteristiques-section">
            <div class="container">
                <div class="header">
                    <h1 class="section-title">Caractéristiques du véhicule</h1>
                    <p class="section-subtitle">Indiquez les caractéristiques de votre véhicule</p>
                </div>

                <div class="form-grid">
                    <!-- 1. Marque (dropdown obligatoire) -->
                    <div class="field-card" data-field="marque">
                        <select class="native-select" id="marque-select" onchange="updateFieldDisplay(this)">
                            <option value="">Sélectionnez la marque</option>
                            <option value="PEUGEOT">PEUGEOT</option>
                            <option value="RENAULT">RENAULT</option>
                            <option value="CITROËN">CITROËN</option>
                            <option value="BMW">BMW</option>
                            <option value="MERCEDES">MERCEDES</option>
                        </select>
                        <div class="field-label">MARQUE *</div>
                        <div class="field-value placeholder">Sélectionnez la marque</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 2. Modèle (dropdown obligatoire) -->
                    <div class="field-card" data-field="modele">
                        <select class="native-select" id="modele-select" onchange="updateFieldDisplay(this)">
                            <option value="">Sélectionnez le modèle</option>
                            <option value="208">208</option>
                            <option value="308">308</option>
                            <option value="3008">3008</option>
                            <option value="5008">5008</option>
                        </select>
                        <div class="field-label">MODÈLE *</div>
                        <div class="field-value placeholder">Sélectionnez le modèle</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 3. Année de 1ère immatriculation (dropdown obligatoire) -->
                    <div class="field-card" data-field="annee">
                        <select class="native-select" id="annee-select" onchange="updateFieldDisplay(this)">
                            <option value="">Année de 1e immatriculation</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                        </select>
                        <div class="field-label">ANNÉE DE 1E IMMATRICULATION *</div>
                        <div class="field-value placeholder">Année de 1e immatriculation</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 4. Mois de 1ère immatriculation (dropdown obligatoire) -->
                    <div class="field-card" data-field="mois">
                        <select class="native-select" id="mois-select" onchange="updateFieldDisplay(this)">
                            <option value="">Mois de 1e immatriculation</option>
                            <option value="Janvier">Janvier</option>
                            <option value="Février">Février</option>
                            <option value="Mars">Mars</option>
                            <option value="Avril">Avril</option>
                            <option value="Mai">Mai</option>
                            <option value="Juin">Juin</option>
                            <option value="Juillet">Juillet</option>
                            <option value="Août">Août</option>
                            <option value="Septembre">Septembre</option>
                            <option value="Octobre">Octobre</option>
                            <option value="Novembre">Novembre</option>
                            <option value="Décembre">Décembre</option>
                        </select>
                        <div class="field-label">MOIS DE 1E IMMATRICULATION *</div>
                        <div class="field-value placeholder">Mois de 1e immatriculation</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 5. Carburant (dropdown) -->
                    <div class="field-card" data-field="carburant">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Carburant</option>
                            <option value="Essence">Essence</option>
                            <option value="Diesel">Diesel</option>
                            <option value="Hybride">Hybride</option>
                            <option value="Électrique">Électrique</option>
                            <option value="GPL">GPL</option>
                        </select>
                        <div class="field-label">CARBURANT</div>
                        <div class="field-value placeholder">Carburant</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 6. Carrosserie (dropdown) -->
                    <div class="field-card" data-field="carrosserie">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Carrosserie</option>
                            <option value="Berline">Berline</option>
                            <option value="Break">Break</option>
                            <option value="SUV">SUV</option>
                            <option value="Coupé">Coupé</option>
                            <option value="Cabriolet">Cabriolet</option>
                            <option value="Monospace">Monospace</option>
                            <option value="Citadine">Citadine</option>
                        </select>
                        <div class="field-label">CARROSSERIE</div>
                        <div class="field-value placeholder">Carrosserie</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 7. Nombre de portes (dropdown) -->
                    <div class="field-card" data-field="portes">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Nombre de portes</option>
                            <option value="3 portes">3 portes</option>
                            <option value="5 portes">5 portes</option>
                            <option value="4 portes">4 portes</option>
                            <option value="2 portes">2 portes</option>
                        </select>
                        <div class="field-label">NOMBRE DE PORTES</div>
                        <div class="field-value placeholder">Nombre de portes</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 8. Boîte de vitesses (dropdown) -->
                    <div class="field-card" data-field="boite-vitesses">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Boîte de vitesses</option>
                            <option value="Manuelle">Manuelle</option>
                            <option value="Automatique">Automatique</option>
                            <option value="Robotisée">Robotisée</option>
                            <option value="CVT">CVT</option>
                        </select>
                        <div class="field-label">BOÎTE DE VITESSES</div>
                        <div class="field-value placeholder">Boîte de vitesses</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 9. Puissance fiscale (dropdown) -->
                    <div class="field-card" data-field="puissance-fiscale">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Puissance fiscale</option>
                            <option value="4 CV">4 CV</option>
                            <option value="5 CV">5 CV</option>
                            <option value="6 CV">6 CV</option>
                            <option value="7 CV">7 CV</option>
                            <option value="8 CV">8 CV</option>
                            <option value="9 CV">9 CV</option>
                            <option value="10 CV">10 CV</option>
                        </select>
                        <div class="field-label">PUISSANCE FISCALE</div>
                        <div class="field-value placeholder">Puissance fiscale</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 10. Puissance moteur (dropdown) -->
                    <div class="field-card" data-field="puissance-moteur">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Puissance moteur (Ch)</option>
                            <option value="75 Ch">75 Ch</option>
                            <option value="90 Ch">90 Ch</option>
                            <option value="110 Ch">110 Ch</option>
                            <option value="130 Ch">130 Ch</option>
                            <option value="150 Ch">150 Ch</option>
                            <option value="180 Ch">180 Ch</option>
                            <option value="Je ne sais pas">Je ne sais pas</option>
                        </select>
                        <div class="field-label">PUISSANCE MOTEUR (CH)</div>
                        <div class="field-value placeholder">Puissance moteur (Ch)</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 11. Couleur (dropdown) -->
                    <div class="field-card" data-field="couleur">
                        <select class="native-select" onchange="updateFieldDisplay(this)">
                            <option value="">Sélectionnez la couleur</option>
                            <option value="Blanc">Blanc</option>
                            <option value="Noir">Noir</option>
                            <option value="Gris">Gris</option>
                            <option value="Rouge">Rouge</option>
                            <option value="Bleu">Bleu</option>
                            <option value="Argent">Argent</option>
                            <option value="Autre">Autre</option>
                        </select>
                        <div class="field-label">COULEUR</div>
                        <div class="field-value placeholder">Sélectionnez la couleur</div>
                        <div class="chevron"></div>
                    </div>

                    <!-- 12. Kilométrage (input numérique obligatoire) -->
                    <div class="field-card" data-field="kilometrage">
                        <div class="field-label">KILOMÉTRAGE *</div>
                        <input type="number" class="field-input" id="kilometrage-input" placeholder="Précisez le kilométrage de la voiture" min="0" max="500000" />
                    </div>

                    <!-- 13. Version du véhicule (dropdown obligatoire) -->
                    <div class="field-card" data-field="version">
                        <select class="native-select" id="version-select" onchange="updateFieldDisplay(this)">
                            <option value="">Sélectionnez la version</option>
                            <option value="Active 1.2 PureTech 100">Active 1.2 PureTech 100</option>
                            <option value="Allure 1.2 PureTech 130">Allure 1.2 PureTech 130</option>
                            <option value="GT Line 1.2 PureTech 130">GT Line 1.2 PureTech 130</option>
                            <option value="GT 1.6 THP 205">GT 1.6 THP 205</option>
                            <option value="Style 1.0 VTi 68">Style 1.0 VTi 68</option>
                            <option value="Shine 1.2 PureTech 110">Shine 1.2 PureTech 110</option>
                            <option value="Crossway 1.2 PureTech 110">Crossway 1.2 PureTech 110</option>
                            <option value="Roland Garros 1.2 PureTech 100">Roland Garros 1.2 PureTech 100</option>
                            <option value="Signature 1.2 PureTech 130">Signature 1.2 PureTech 130</option>
                            <option value="Tech Edition 1.2 PureTech 100">Tech Edition 1.2 PureTech 100</option>
                        </select>
                        <div class="field-label">VERSION *</div>
                        <div class="field-value placeholder">Sélectionnez la version</div>
                        <div class="chevron"></div>
                    </div>
                </div>

                <!-- Ajout de la réassurance version (cachée par défaut) -->
                <div id="version-reassurance" style="background-color: #eff6ff; border-radius: 0.75rem; padding: 1.5rem; border: 1px solid #bfdbfe; display: none; margin: 30px 0;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; color: #1e3a8a; margin-bottom: 0.5rem;">Pourquoi la version ?</h3>
                    <p style="color: #1e40af; line-height: 1.6; margin: 0; font-size: 1rem;">La version est une information importante et décisive sur le prix final</p>
                </div>

                <!-- Réassurance sous le champ Version -->
                <div style="text-align: center; margin: 20px 0; font-size: 14px; color: #666;">
                    🔒 Toutes les versions sont vérifiées et officielles, vous pouvez choisir en toute confiance.
                </div>

                <div class="separator"></div>
            </div>
        </div>
    </section>

    <!-- Section État Général (HTML original conservé, cachée par défaut) -->
    <section class="progressive-section" id="etat-section">
        <div class="main-section">
            <div class="container">
                <div class="header">
                    <h1 class="section-title">État général du véhicule</h1>
                    <p class="section-subtitle">Évaluez l'état global de votre véhicule</p>
                </div>

                <div class="cards-row">
                    <!-- Added onclick events to make state cards clickable -->
                    <div class="state-card" data-state="excellent" data-impact="0" onclick="selectEtat(this)">
                        <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <h3 class="card-title">Excellent état</h3>
                        <p class="card-subtitle">Comme neuf</p>
                    </div>

                    <div class="state-card" data-state="tresBon" data-impact="-5" onclick="selectEtat(this)">
                        <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <h3 class="card-title">Très bon état</h3>
                        <p class="card-subtitle">Quelques rayures</p>
                    </div>

                    <div class="state-card" data-state="bon" data-impact="-10" onclick="selectEtat(this)">
                        <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <h3 class="card-title">Bon</h3>
                        <p class="card-subtitle">Usure normale</p>
                    </div>

                    <div class="state-card" data-state="correct" data-impact="-15" onclick="selectEtat(this)">
                        <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <h3 class="card-title">Correct</h3>
                        <p class="card-subtitle">Usure visible</p>
                    </div>

                    <div class="state-card" data-state="mauvais" data-impact="-25" onclick="selectEtat(this)">
                        <svg class="star-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <h3 class="card-title">Mauvais état</h3>
                        <p class="card-subtitle">Réparations importantes<br>à prévoir</p>
                    </div>
                </div>

                <div class="explanation-zone">
                    <h2 class="selected-state-title" id="state-title">-</h2>
                    <p class="selected-state-description" id="state-description">Sélectionnez un état</p>
                    <span class="impact-chip" id="impact-chip" style="display:none;">Impact sur le prix : -</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Options (HTML original conservé, cachée par défaut) -->
    <section class="progressive-section" id="options-equipements-section">
        <div class="container" style="padding: 40px 20px;">
            <div class="header">
                <h1 class="section-title">Options & équipements</h1>
                <p class="section-subtitle">Sélectionnez les équipements présents sur votre véhicule</p>
            </div>

            <div class="options-grid" id="optionsGrid">
                <!-- Options générées dynamiquement -->
            </div>

            <div class="info-section">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1e3a8a; margin-bottom: 0.5rem;">Pourquoi ces informations ?</h3>
                <p style="color: #1e40af; line-height: 1.6; margin: 0; font-size: 1rem;">Chaque équipement valorise votre véhicule sur le marché de l'occasion. Les options de sécurité et technologie sont particulièrement recherchées.</p>
            </div>
        </div>
    </section>

    <!-- Section Contact (HTML original conservé, cachée par défaut) -->
    <section class="progressive-section" id="contact-section">
        <div class="main-section">
            <div class="container">
                <!-- Adding new summary header block -->
                <div class="summary-block">
                    <div class="summary-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.22.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                        </svg>
                    </div>
                    <div class="summary-content">
                        <div class="summary-main">
                            <div class="summary-label">Votre prix</div>
                            <div class="summary-price">XX XXX€</div>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-secondary">
                            <!-- Replacing reference with remaining steps -->
                            <div class="steps-accent"></div>
                            <div class="summary-secondary-text">2 étapes restantes pour débloquer</div>
                        </div>
                    </div>
                </div>

                <div class="header">
                    <h1 class="section-title">Vos informations personnelles</h1>
                    <p class="section-subtitle">Commençons par vous connaître</p>
                </div>

                <div class="form-grid">
                    <!-- Keeping only personal information fields in this section -->
                    <div class="field-card" data-field="nom">
                        <div class="field-label">NOM *</div>
                        <input type="text" class="field-input" placeholder="Votre nom" />
                    </div>

                    <div class="field-card" data-field="prenom">
                        <div class="field-label">PRÉNOM *</div>
                        <input type="text" class="field-input" placeholder="Votre prénom" />
                    </div>

                    <div class="field-card" data-field="email">
                        <div class="field-label">EMAIL *</div>
                        <input type="email" class="field-input" placeholder="votre.email@exemple.com" />
                    </div>

                    <div class="field-card" data-field="telephone">
                        <div class="field-label">TÉLÉPHONE *</div>
                        <input type="tel" class="field-input" placeholder="01 23 45 67 89" />
                    </div>
                </div>

                <!-- Adding separate section for project information -->
                <div class="project-section" style="margin-top: 50px;">
                    <!-- Harmonized title structure and styling to match other sections -->
                    <div class="header">
                        <h1 class="section-title">Informations sur votre projet</h1>
                        <p class="section-subtitle">Détails de votre futur véhicule</p>
                    </div>
                    
                    <!-- Modified grid to support 3 columns and added vehicle type field -->
                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div class="field-card" data-field="projet">
                            <select class="native-select" id="projet-select">
                                <option value="">Choisir un modèle</option>
                                <option value="Modèle 1">Modèle 1</option>
                                <option value="Modèle 2">Modèle 2</option>
                                <option value="Modèle 3">Modèle 3</option>
                            </select>
                            <div class="field-label">PROJET D'ACHAT</div>
                            <div class="field-value placeholder">Choisir un modèle</div>
                            <div class="chevron"></div>
                        </div>

                        <div class="field-card" data-field="date">
                            <select class="native-select" id="date-select">
                                <option value="">Choisir un délai</option>
                                <option value="Dans 1 mois">Dans 1 mois</option>
                                <option value="Dans 3 mois">Dans 3 mois</option>
                                <option value="Dans 6 mois">Dans 6 mois</option>
                                <option value="Dans 1 an">Dans 1 an</option>
                            </select>
                            <div class="field-label">DATE PRÉVU DE L'ACHAT</div>
                            <div class="field-value placeholder">Choisir un délai</div>
                            <div class="chevron"></div>
                        </div>

                        <!-- Added new vehicle type dropdown -->
                        <div class="field-card" data-field="type-vehicule">
                            <select class="native-select" id="type-vehicule-select">
                                <option value="">Choisir un type</option>
                                <option value="Véhicule neuf">Véhicule neuf</option>
                                <option value="Véhicule d'occasion">Véhicule d'occasion</option>
                                <option value="Pas de projet d'achat">Pas de projet d'achat</option>
                            </select>
                            <div class="field-label">TYPE DE VÉHICULE</div>
                            <div class="field-value placeholder">Choisir un type</div>
                            <div class="chevron"></div>
                        </div>
                    </div>
                </div>

                <!-- Updated contact preferences HTML structure -->
                <div class="contact-preferences">
                    <!-- Added consistent header structure with title and subtitle -->
                    <div class="header">
                        <h1 class="section-title">Comment préférez-vous être contacté ?</h1>
                        <p class="section-subtitle">Choisissez votre mode de contact préféré</p>
                    </div>
                    <div class="contact-grid">
                        <div class="contact-card" data-contact="telephone">
                            <div class="contact-checkbox"></div>
                            <div class="contact-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <!-- Fixed phone SVG path to display proper phone icon -->
                                    <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                                </svg>
                            </div>
                            <div class="contact-info">
                                <div class="contact-title">Téléphone</div>
                                <div class="contact-subtitle">Appel direct</div>
                            </div>
                        </div>

                        <div class="contact-card" data-contact="email">
                            <div class="contact-checkbox"></div>
                            <div class="contact-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                            </div>
                            <div class="contact-info">
                                <div class="contact-title">Email</div>
                                <div class="contact-subtitle">Courrier électronique</div>
                            </div>
                        </div>

                        <div class="contact-card" data-contact="sms">
                            <div class="contact-checkbox"></div>
                            <div class="contact-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                                </svg>
                            </div>
                            <div class="contact-info">
                                <div class="contact-title">SMS</div>
                                <div class="contact-subtitle">Message texte</div>
                            </div>
                        </div>

                        <div class="contact-card" data-contact="whatsapp">
                            <div class="contact-checkbox"></div>
                            <div class="contact-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17.05 12.05c-.3-.15-1.75-.85-2.02-.95-.27-.1-.47-.15-.67.15-.2.3-.77.95-.94 1.15-.17.2-.35.22-.64.07-.3-.15-1.26-.46-2.4-1.47-.88-.78-1.48-1.75-1.65-2.05-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.52-.08-.15-.67-1.61-.92-2.21-.24-.58-.49-.5-.67-.51-.17-.01-.37-.01-.57-.01-.2 0-.52.07-.79.37-.27.3-1.04 1.02-1.04 2.48 0 1.46 1.07 2.87 1.22 3.07.15.2 2.11 3.22 5.11 4.52.71.31 1.27.49 1.7.63.71.23 1.36.2 1.87.12.57-.09 1.75-.72 2-.1.25-.69.25-1.29.17-1.41-.07-.12-.27-.2-.57-.35M12.04 2.04C6.5 2.04 2.04 6.5 2.04 12.04c0 1.75.46 3.5 1.32 5.02L2 22l5.07-1.33c1.48.81 3.15 1.24 4.97 1.24 5.54 0 10.04-4.5 10.04-10.04S17.58 2.04 12.04 2.04"/>
                                </svg>
                            </div>
                            <div class="contact-info">
                                <div class="contact-title">WhatsApp</div>
                                <div class="contact-subtitle">Message instantané</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Adding bonus block after contact preferences -->
                <div class="bonus-block">
                    <div class="bonus-content">
                        <div class="bonus-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <div class="bonus-text">
                            <div class="bonus-title">Bonus à la reprise</div>
                            <div class="bonus-subtitle">Profitez jusqu'à 2000€ de bonus pour l'achat d'un véhicule neuf</div>
                        </div>
                    </div>
                </div>

                <!-- Adding CTA button section -->
                <div class="cta-section">
                    <button class="cta-button" type="submit">Obtenez votre estimation</button>
                </div>

                <div class="footer-section">
                    <div class="footer-info">Données sécurisées • Aucun engagement</div>
                </div>
            </div>
        </div>
    </section>

    <script>
        let currentPath = null;

        // Gestion des options pour la section équipements - FONCTION CORRIGÉE
        const options = [
            { id: "1", name: "Climatisation", category: "Confort", categoryClass: "category-confort", selected: false },
            { id: "2", name: "GPS / Navigation", category: "Technologie", categoryClass: "category-technologie", selected: false },
            { id: "3", name: "Bluetooth / Mains libres", category: "Technologie", categoryClass: "category-technologie", selected: false },
            { id: "4", name: "Caméra de recul", category: "Sécurité", categoryClass: "category-securite", selected: false },
            { id: "5", name: "Régulateur de vitesse", category: "Confort", categoryClass: "category-confort", selected: false },
            { id: "6", name: "Sièges chauffants", category: "Confort", categoryClass: "category-confort", selected: false },
            { id: "7", name: "Jantes alliage", category: "Esthétique", categoryClass: "category-esthetique", selected: false },
            { id: "8", name: "Toit ouvrant", category: "Confort", categoryClass: "category-confort", selected: false },
            { id: "9", name: "Attelage", category: "Pratique", categoryClass: "category-pratique", selected: false }
        ];

        // FONCTION CORRIGÉE POUR LE RENDU DES OPTIONS
        function renderOptions() {
            const grid = document.getElementById('optionsGrid');
            if (!grid) return;
            
            grid.innerHTML = options.map(option => `
                <div class="option-card ${option.selected ? 'selected' : ''}" onclick="toggleOption('${option.id}')">
                    <div class="card-header">
                        <div class="category-badge" style="background-color: ${getCategoryColor(option.category)}; color: ${getCategoryTextColor(option.category)};">
                            ${option.category}
                        </div>
                        <div class="checkbox ${option.selected ? 'checked' : ''}">
                            ${option.selected ? '<span style="color: white; font-size: 12px;">✓</span>' : ''}
                        </div>
                    </div>
                    <div class="option-name">${option.name}</div>
                </div>
            `).join('');
        }

        // FONCTION CORRIGÉE POUR GÉRER LA SÉLECTION DES OPTIONS
        function toggleOption(optionId) {
            const option = options.find(opt => opt.id === optionId);
            if (option) {
                option.selected = !option.selected;
                renderOptions();
                
                // Vérifier après un court délai pour permettre le rendu
                setTimeout(() => {
                    checkOptionsValidation();
                }, 100);
            }
        }

        // Fonction pour afficher la section immatriculation
        function showImmatriculation() {
            currentPath = 'immatriculation';
            document.getElementById('caracteristiques-section').classList.remove('revealed');
            document.getElementById('immatriculation-section').classList.add('revealed');
            
            document.querySelectorAll('.options .card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            setTimeout(() => {
                document.getElementById('immatriculation-section').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Fonction pour afficher la section caractéristiques
        function showCaracteristiques() {
            currentPath = 'caracteristiques';
            document.getElementById('immatriculation-section').classList.remove('revealed');
            document.getElementById('caracteristiques-section').classList.add('revealed');
            
            document.querySelectorAll('.options .card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            setTimeout(() => {
                document.getElementById('caracteristiques-section').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Fonctions pour la section immatriculation (du nouveau module)
        function validateImmatFormat(input) {
            let value = input.value.replace(/[\s-]/g, '').toUpperCase();
            input.value = value;
            
            const regex = /^[A-Z]{2}\d{3}[A-Z]{2}$/;
            const isValid = regex.test(value);
            const errorDiv = document.getElementById('immat-error');
            
            if (value && !isValid) {
                input.style.borderColor = '#ff4444';
                errorDiv.style.display = 'block';
            } else {
                input.style.borderColor = isValid ? '#4F46E5' : '#ddd';
                errorDiv.style.display = 'none';
            }
            
            updateSearchButtonState();
        }

        function validateKmFormat(input) {
            const value = input.value;
            const kmError = document.getElementById('km-error');
            const isValid = value && !isNaN(value) && parseInt(value) >= 0 && parseInt(value) <= 500000;
            
            if (value && !isValid) {
                input.style.borderColor = '#ff4444';
                kmError.style.display = 'block';
            } else {
                input.style.borderColor = isValid ? '#4F46E5' : '#ddd';
                kmError.style.display = 'none';
            }
            
            updateSearchButtonState();
        }

        function updateSearchButtonState() {
            const immatInput = document.getElementById('immat-input');
            const kmInput = document.getElementById('km-input');
            const searchBtn = document.getElementById('search-btn');
            
            const immatValid = /^[A-Z]{2}\d{3}[A-Z]{2}$/.test(immatInput.value);
            const kmValid = kmInput.value && !isNaN(kmInput.value) && parseInt(kmInput.value) >= 0 && parseInt(kmInput.value) <= 500000;
            
            if (immatValid && kmValid) {
                searchBtn.disabled = false;
                searchBtn.classList.add('active');
            } else {
                searchBtn.disabled = true;
                searchBtn.classList.remove('active');
            }
        }

        function searchImmatriculation() {
            const searchBtn = document.getElementById('search-btn');
            
            if (searchBtn.disabled) return;
            
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<div class="spinner"></div><span>Recherche…</span>';
            
            const delay = Math.random() * 400 + 800;
            
            setTimeout(() => {
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<span>Rechercher le véhicule</span>';
                
                // Check if mobile
                if (window.innerWidth <= 768) {
                    showMobileModal();
                } else {
                    showDesktopResult();
                }
                
            }, delay);
        }

        function showDesktopResult() {
            const resultCard = document.getElementById('result-card');
            resultCard.style.display = 'block';
            resultCard.style.opacity = '0';
            resultCard.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                resultCard.style.transition = 'all 0.3s ease';
                resultCard.style.opacity = '1';
                resultCard.style.transform = 'translateY(0)';
            }, 10);
        }

        function showMobileModal() {
            const modal = document.getElementById('mobile-modal');
            modal.style.display = 'flex';
            
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }

        function closeModal(event) {
            if (event && event.target !== event.currentTarget && event.type === 'click') {
                return;
            }
            
            const modal = document.getElementById('mobile-modal');
            modal.classList.remove('show');
            
            setTimeout(() => {
                modal.style.display = 'none';
                // Reset modal form
                const select = document.getElementById('modal-version-select-mobile');
                select.value = '';
                updateModalFieldDisplay(select);
                updateModalValidateButton();
            }, 300);
        }

        function updateFieldDisplay(selectElement) {
            const fieldCard = selectElement.closest('.field-card');
            const fieldValue = fieldCard.querySelector('.field-value');
            
            if (selectElement.value) {
                fieldValue.textContent = selectElement.value;
                fieldValue.classList.remove('placeholder');
                fieldCard.classList.add('selected');
                
                // Afficher la réassurance version si c'est le champ version
                if (selectElement.id === 'version-select') {
                    const versionReassurance = document.getElementById('version-reassurance');
                    if (versionReassurance) {
                        versionReassurance.style.display = 'block';
                    }
                }
            } else {
                fieldValue.textContent = selectElement.querySelector('option[value=""]').textContent;
                fieldValue.classList.add('placeholder');
                fieldCard.classList.remove('selected');
                
                // Cacher la réassurance version si c'est le champ version
                if (selectElement.id === 'version-select') {
                    const versionReassurance = document.getElementById('version-reassurance');
                    if (versionReassurance) {
                        versionReassurance.style.display = 'none';
                    }
                }
            }
            
            checkCaracteristiquesCompletion();
        }

        function updateModalFieldDisplay(selectElement) {
            const fieldCard = selectElement.closest('.modal-field-card');
            const fieldValue = fieldCard.querySelector('.field-value');
            
            if (selectElement.value) {
                fieldValue.textContent = selectElement.value;
                fieldValue.classList.remove('placeholder');
                fieldCard.classList.add('selected');
            } else {
                fieldValue.textContent = selectElement.querySelector('option[value=""]').textContent;
                fieldValue.classList.add('placeholder');
                fieldCard.classList.remove('selected');
            }
        }

        function updateValidateButton() {
            const versionSelect = document.getElementById('modal-version-select');
            const validateButton = document.getElementById('validate-button');
            
            if (versionSelect.value) {
                validateButton.disabled = false;
                validateButton.classList.remove('disabled');
            } else {
                validateButton.disabled = true;
                validateButton.classList.add('disabled');
            }
        }

        function updateModalValidateButton() {
            const versionSelect = document.getElementById('modal-version-select-mobile');
            const validateButton = document.getElementById('modal-validate-button');
            
            if (versionSelect.value) {
                validateButton.disabled = false;
                validateButton.classList.remove('disabled');
            } else {
                validateButton.disabled = true;
                validateButton.classList.add('disabled');
            }
        }

        function proceedToNextStep() {
            const versionSelect = document.getElementById('modal-version-select');
            if (!versionSelect.value) {
                alert('Veuillez sélectionner une version de véhicule');
                return;
            }
            
            // Reveal next section
            const nextSection = document.getElementById('etat-section');
            if (nextSection) {
                nextSection.classList.add('revealed');
                setTimeout(() => {
                    nextSection.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }
        }

        function proceedToNextStepFromModal() {
            const versionSelect = document.getElementById('modal-version-select-mobile');
            if (!versionSelect.value) {
                alert('Veuillez sélectionner une version de véhicule');
                return;
            }
            
            closeModal();
            // Reveal next section
            const nextSection = document.getElementById('etat-section');
            if (nextSection) {
                nextSection.classList.add('revealed');
                setTimeout(() => {
                    nextSection.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }
        }

        function checkCaracteristiquesCompletion() {
            // Check required fields by their actual IDs
            const requiredFields = [
                'marque-select',
                'modele-select', 
                'annee-select',
                'mois-select',
                'kilometrage-input',
                'version-select'
            ];
            
            let allRequiredCompleted = true;
            
            requiredFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (!element || !element.value || element.value === '') {
                    allRequiredCompleted = false;
                }
            });
            
            if (allRequiredCompleted) {
                revealEtatSection();
                setTimeout(() => {
                    const etatSection = document.getElementById('etat-section');
                    if (etatSection) {
                        etatSection.scrollIntoView({ 
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }, 300);
            } else {
                hideEtatSection();
            }
        }

        function revealEtatSection() {
            document.getElementById('etat-section').classList.add('revealed');
        }

        function hideEtatSection() {
            document.getElementById('etat-section').classList.remove('revealed');
            document.getElementById('options-equipements-section').classList.remove('revealed');
            document.getElementById('contact-section').classList.remove('revealed');
        }

        // Sélection de l'état - FONCTION CORRIGÉE
        function selectEtat(element) {
            document.querySelectorAll('.state-card').forEach(c => c.classList.remove('selected'));
            element.classList.add('selected');
            
            // Mise à jour de la zone d'explication
            const state = element.dataset.state;
            const stateDescriptions = {
                excellent: {
                    title: "Excellent état",
                    description: "Véhicule en parfait état, comme neuf",
                    impact: 0
                },
                tresBon: {
                    title: "Très bon état",
                    description: "Quelques traces d'usure mineures",
                    impact: -5
                },
                bon: {
                    title: "Bon",
                    description: "Usure normale correspondant à l'âge du véhicule",
                    impact: -10
                },
                correct: {
                    title: "Correct",
                    description: "Usure visible mais fonctionnement correct",
                    impact: -15
                },
                mauvais: {
                    title: "Mauvais état",
                    description: "Nombreux défauts, nécessite réparations",
                    impact: -25
                }
            };
            
            const stateInfo = stateDescriptions[state];
            document.getElementById('state-title').textContent = stateInfo.title;
            document.getElementById('state-description').textContent = stateInfo.description;
            
            const impactChip = document.getElementById('impact-chip');
            impactChip.style.display = 'inline-block';
            
            // Mettre à jour l'impact
            if (stateInfo.impact === 0) {
                impactChip.textContent = "Impact sur le prix : Aucun";
                impactChip.style.background = "#EBF4FF";
                impactChip.style.color = "#4F46E5";
            } else {
                impactChip.textContent = `Impact sur le prix : ${stateInfo.impact}%`;
                impactChip.style.background = "#D6DCFF";
                impactChip.style.color = "#4F46E5";
            }
            
            // CORRECTION : D'abord rendre les options, puis révéler la section
            setTimeout(() => {
                renderOptions();  // Générer le HTML des options
                revealOptionsEquipementsSection();  // Révéler la section
            }, 500); // Petit délai pour laisser l'animation de l'état se terminer
        }

        function revealOptionsEquipementsSection() {
            const optionsSection = document.getElementById('options-equipements-section');
            optionsSection.classList.add('revealed');
            
            // CORRECTION : Scroll après que les options soient rendues
            setTimeout(() => {
                optionsSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 300);
        }

        // FONCTION CORRIGÉE : Vérification de la validation des options
        function checkOptionsValidation() {
            // Attendre que les options soient présentes dans le DOM
            const optionCards = document.querySelectorAll('.option-card');
            if (optionCards.length === 0) {
                return; // Les options ne sont pas encore rendues
            }
            
            const selected = options.filter(opt => opt.selected);
            
            if (selected.length > 0) {
                const contactSection = document.getElementById('contact-section');
                contactSection.classList.add('revealed');
                
                // CORRECTION : Scroll vers la section contact
                setTimeout(() => {
                    contactSection.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 300);
            } else {
                document.getElementById('contact-section').classList.remove('revealed');
            }
        }

        // Helpers pour les couleurs des catégories
        function getCategoryColor(category) {
            const colors = {
                'Confort': '#dbeafe',
                'Technologie': '#e9d5ff',
                'Sécurité': '#d1fae5',
                'Esthétique': '#fed7aa',
                'Pratique': '#f3f4f6'
            };
            return colors[category] || '#f3f4f6';
        }

        function getCategoryTextColor(category) {
            const colors = {
                'Confort': '#1d4ed8',
                'Technologie': '#7c3aed',
                'Sécurité': '#059669',
                'Esthétique': '#ea580c',
                'Pratique': '#374151'
            };
            return colors[category] || '#374151';
        }

        // Gestion des inputs
        document.addEventListener('DOMContentLoaded', function() {
            // Gestion des inputs de texte
            document.querySelectorAll('.field-input').forEach(input => {
                input.addEventListener('input', function() {
                    const card = this.closest('.field-card');
                    if (this.value.trim()) {
                        card.classList.add('selected');
                    } else {
                        card.classList.remove('selected');
                    }
                    
                    // Vérifier la completion pour les champs obligatoires
                    if (this.id === 'kilometrage-input') {
                        checkCaracteristiquesCompletion();
                    }
                });
            });

            // Gestion des selects natifs
            document.querySelectorAll('.native-select').forEach(select => {
                select.addEventListener('change', function() {
                    const card = this.closest('.field-card');
                    const valueElement = card ? card.querySelector('.field-value') : null;
                    
                    if (valueElement) {
                        if (this.value) {
                            valueElement.textContent = this.value;
                            valueElement.classList.remove('placeholder');
                            card.classList.add('selected');
                        } else {
                            valueElement.textContent = this.options[0].text;
                            valueElement.classList.add('placeholder');
                            card.classList.remove('selected');
                        }
                    }
                });
            });

            // Adding clean contact option card handlers
            document.querySelectorAll('.contact-card').forEach(card => {
                card.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const modal = document.getElementById('mobile-modal');
            if (window.innerWidth > 768 && modal.classList.contains('show')) {
                closeModal();
                showDesktopResult();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('mobile-modal');
                if (modal.classList.contains('show')) {
                    closeModal();
                }
            }
        });

        document.getElementById('type-vehicule-select').addEventListener('change', function() {
            const card = this.closest('.field-card');
            const valueDisplay = card.querySelector('.field-value');
            const chevron = card.querySelector('.chevron');
            
            if (this.value) {
                valueDisplay.textContent = this.value;
                valueDisplay.classList.remove('placeholder');
                card.classList.add('selected');
                
                // Replace chevron with checkmark
                chevron.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M16.25 6.25L8.125 14.375L3.75 10" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                chevron.style.backgroundColor = '#4F46E5';
                chevron.style.borderRadius = '50%';
                chevron.style.padding = '2px';
            } else {
                valueDisplay.textContent = 'Choisir un type';
                valueDisplay.classList.add('placeholder');
                card.classList.remove('selected');
                
                // Restore chevron
                chevron.innerHTML = '';
                chevron.style.backgroundColor = '';
                chevron.style.borderRadius = '';
                chevron.style.padding = '';
            }
        });
    </script>
</body>
</html>
